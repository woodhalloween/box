# 頭部検出・首振り検知システム

このシステムは、ビデオ内の人物の頭部を検出し、「首振り」（頭部の左右の動き）を検知するための機能を提供します。

## 機能

- YOLOベースの頭部検出 (`run_head_detection.py`)
- MediaPipe Poseベースの棒人間検出 (`run_stick_figure_detection.py`)
- 首振り（左右の頭部の動き）の検知
- 検出結果の視覚化
- 検出ログの保存

## 実行方法

### YOLOベースの頭部検出

```bash
python run_head_detection.py --video 入力動画.mp4 --output 出力動画.mp4
```

### MediaPipeベースの棒人間検出

```bash
python run_stick_figure_detection.py --video 入力動画.mp4 --output 出力動画.mp4
```

## 主なオプション

### 共通オプション

- `--video FILE`: 処理する動画ファイルのパス（デフォルト: WIN_20250319_10_03_53_Pro.mp4）
- `--output FILE`: 出力動画のパス
- `--no-save`: 動画を保存しない
- `--no-preview`: プレビューを表示しない
- `--log-dir DIR`: ログを保存するディレクトリ（デフォルト: logs）
- `--movement-threshold FLOAT`: 首振りと判定する移動量の閾値（画像幅に対する割合）
- `--consecutive-frames INT`: 首振りと判定する連続フレーム数
- `--confidence FLOAT`: 検出信頼度閾値
- `--cooldown FLOAT`: 検出後のクールダウン時間（秒）
- `--min-duration FLOAT`: 首振りイベントの最小持続時間（秒）

### YOLOモデル専用オプション

- `--model FILE`: YOLOモデルのパス（デフォルト: yolo11n.pt）

### MediaPipe専用オプション

- `--model-complexity INT`: モデルの複雑度（0=Lite, 1=Full, 2=Heavy）

## 検出アルゴリズムの比較

### YOLOベースの頭部検出

- 特徴: 一般的な頭部検出に優れる
- 処理速度: 中程度
- 検出精度: 高い（顔が見えていれば）
- ユースケース: 監視カメラ、来店客分析など

### MediaPipeベースの棒人間検出

- 特徴: 骨格全体を検出、顔の向きが変わっても頭部位置を安定して追跡
- 処理速度: 高速
- 検出精度: 中程度（全身が見えるとより正確）
- ユースケース: 動作分析、ジェスチャー検出など

## 調整のヒント

首振り検出の精度を向上させるには、以下のパラメータを調整してください：

1. **動き閾値** (`--movement-threshold`): 
   - 値を小さくすると感度が上がり、小さな動きも検出
   - 値を大きくすると明確な動きのみ検出

2. **連続フレーム数** (`--consecutive-frames`):
   - 値を小さくするとより短い動きも検出
   - 値を大きくすると持続的な動きのみ検出

3. **最小持続時間** (`--min-duration`):
   - 誤検出を減らすために適切な値を設定
   - 通常は0.2〜0.5秒が適切

## ログ出力

システムは以下のログを生成します：

1. 検出ログ: 各フレームでの頭部位置と検出状態
2. イベントログ: 検出された首振りイベントの開始・終了時間

これらのログは分析のためにCSVファイルとして保存されます。 